# -*- coding: utf-8 -*-
# Python version: Python 3.4.3

import re
from scrapy.http import HtmlResponse


# http://movie.mtime.com/people/search/section/    影人搜索

html = """<ul class="ser_mlist2"> <li> <div class="table"> <div class="t_r"> <div class="td"> <a title="张艺谋/Yimou Zhang" target="_blank" href="http://people.mtime.com/893000/"> <img width="96" height="128" class="img_box" alt="张艺谋/Yimou Zhang" src="http://img31.mtime.cn/ph/1000/893000/893000_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>7</span><span class=total2>.0</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/893000/">张艺谋</a></h3> <p> <a target="_blank" href="http://people.mtime.com/893000/">Yimou Zhang</a></p> <p class="mt15 c_666">男，生于1950年4月2日(中国，陕西西安)</p> <p class="c_666 mt6">3030人评分</p> </div> </div> </div> <div class="table"> <div class="t_r"> <div class="td"> <a title="马丁·斯科塞斯/Martin Scorsese" target="_blank" href="http://people.mtime.com/892776/"> <img width="96" height="128" class="img_box" alt="马丁·斯科塞斯/Martin Scorsese" src="http://img31.mtime.cn/ph/776/892776/892776_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.1</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/892776/">马丁·斯科塞斯</a></h3> <p> <a target="_blank" href="http://people.mtime.com/892776/">Martin Scorsese</a></p> <p class="mt15 c_666">男，生于1942年11月17日(美国纽约皇后区)</p> <p class="c_666 mt6">2987人评分</p> </div> </div> </div> </li> <li> <div class="table"> <div class="t_r"> <div class="td"> <a title="阿尔弗雷德·希区柯克/Alfred Hitchcock" target="_blank" href="http://people.mtime.com/892746/"> <img width="96" height="128" class="img_box" alt="阿尔弗雷德·希区柯克/Alfred Hitchcock" src="http://img31.mtime.cn/ph/746/892746/892746_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.5</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/892746/">阿尔弗雷德·希区柯克</a></h3> <p> <a target="_blank" href="http://people.mtime.com/892746/">Alfred Hitchcock</a></p> <p class="mt15 c_666">男，生于1899年8月13日(英国伦敦)</p> <p class="c_666 mt6">2599人评分</p> </div> </div> </div> <div class="table"> <div class="t_r"> <div class="td"> <a title="吕克·贝松/Luc Besson" target="_blank" href="http://people.mtime.com/892773/"> <img width="96" height="128" class="img_box" alt="吕克·贝松/Luc Besson" src="http://img31.mtime.cn/ph/773/892773/892773_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.0</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/892773/">吕克·贝松</a></h3> <p> <a target="_blank" href="http://people.mtime.com/892773/">Luc Besson</a></p> <p class="mt15 c_666">男，生于1959年3月18日(法国巴黎)</p> <p class="c_666 mt6">2497人评分</p> </div> </div> </div> </li> <li> <div class="table"> <div class="t_r"> <div class="td"> <a title="伍迪·艾伦/Woody Allen" target="_blank" href="http://people.mtime.com/892799/"> <img width="96" height="128" class="img_box" alt="伍迪·艾伦/Woody Allen" src="http://img31.mtime.cn/ph/799/892799/892799_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.1</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/892799/">伍迪·艾伦</a></h3> <p> <a target="_blank" href="http://people.mtime.com/892799/">Woody Allen</a></p> <p class="mt15 c_666">男，生于1935年12月1日(美国纽约布鲁克林区)</p> <p class="c_666 mt6">2268人评分</p> </div> </div> </div> <div class="table"> <div class="t_r"> <div class="td"> <a title="杜琪峯/Johnnie To" target="_blank" href="http://people.mtime.com/892840/"> <img width="96" height="128" class="img_box" alt="杜琪峯/Johnnie To" src="http://img31.mtime.cn/ph/840/892840/892840_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>8</span><span class=total2>.9</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/892840/">杜琪峯</a></h3> <p> <a target="_blank" href="http://people.mtime.com/892840/">Johnnie To</a></p> <p class="mt15 c_666">男，生于1955年4月22日(中国香港)</p> <p class="c_666 mt6">2228人评分</p> </div> </div> </div> </li> <li> <div class="table"> <div class="t_r"> <div class="td"> <a title="查理·卓别林/Charles Chaplin" target="_blank" href="http://people.mtime.com/893728/"> <img width="96" height="128" class="img_box" alt="查理·卓别林/Charles Chaplin" src="http://img31.mtime.cn/ph/1728/893728/893728_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.5</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/893728/">查理·卓别林</a></h3> <p> <a target="_blank" href="http://people.mtime.com/893728/">Charles Chaplin</a></p> <p class="mt15 c_666">男，生于1889年4月16日(英国伦敦)</p> <p class="c_666 mt6">2113人评分</p> </div> </div> </div> <div class="table"> <div class="t_r"> <div class="td"> <a title="李小龙/Bruce Lee" target="_blank" href="http://people.mtime.com/892891/"> <img width="96" height="128" class="img_box" alt="李小龙/Bruce Lee" src="http://img31.mtime.cn/ph/891/892891/892891_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.1</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/892891/">李小龙</a></h3> <p> <a target="_blank" href="http://people.mtime.com/892891/">Bruce Lee</a></p> <p class="mt15 c_666">男，生于1940年11月27日(美国加利福尼亚旧金山)</p> <p class="c_666 mt6">2042人评分</p> </div> </div> </div> </li> <li> <div class="table"> <div class="t_r"> <div class="td"> <a title="杰克·尼科尔森/Jack Nicholson" target="_blank" href="http://people.mtime.com/899413/"> <img width="96" height="128" class="img_box" alt="杰克·尼科尔森/Jack Nicholson" src="http://img31.mtime.cn/ph/1413/899413/899413_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.3</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/899413/">杰克·尼科尔森</a></h3> <p> <a target="_blank" href="http://people.mtime.com/899413/">Jack Nicholson</a></p> <p class="mt15 c_666">男，生于1937年4月22日(美国新泽西州)</p> <p class="c_666 mt6">2035人评分</p> </div> </div> </div> <div class="table"> <div class="t_r"> <div class="td"> <a title="朱迪·福斯特/Jodie Foster" target="_blank" href="http://people.mtime.com/901655/"> <img width="96" height="128" class="img_box" alt="朱迪·福斯特/Jodie Foster" src="http://img31.mtime.cn/ph/1655/901655/901655_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.2</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/901655/">朱迪·福斯特</a></h3> <p> <a target="_blank" href="http://people.mtime.com/901655/">Jodie Foster</a></p> <p class="mt15 c_666">女，生于1962年11月19日(美国加州洛杉矶)</p> <p class="c_666 mt6">1943人评分</p> </div> </div> </div> </li> <li> <div class="table"> <div class="t_r"> <div class="td"> <a title="雷德利·斯科特/Ridley Scott" target="_blank" href="http://people.mtime.com/892786/"> <img width="96" height="128" class="img_box" alt="雷德利·斯科特/Ridley Scott" src="http://img31.mtime.cn/ph/786/892786/892786_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.0</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/892786/">雷德利·斯科特</a></h3> <p> <a target="_blank" href="http://people.mtime.com/892786/">Ridley Scott</a></p> <p class="mt15 c_666">男，生于1937年11月30日(英国)</p> <p class="c_666 mt6">1742人评分</p> </div> </div> </div> <div class="table"> <div class="t_r"> <div class="td"> <a title="上野树里/Juri Ueno" target="_blank" href="http://people.mtime.com/945154/"> <img width="96" height="128" class="img_box" alt="上野树里/Juri Ueno" src="http://img31.mtime.cn/ph/1154/945154/945154_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.2</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/945154/">上野树里</a></h3> <p> <a target="_blank" href="http://people.mtime.com/945154/">Juri Ueno</a></p> <p class="mt15 c_666">女，生于1986年5月25日(日本兵库县加古川市)</p> <p class="c_666 mt6">1717人评分</p> </div> </div> </div> </li> <li> <div class="table"> <div class="t_r"> <div class="td"> <a title="西恩·潘/Sean Penn" target="_blank" href="http://people.mtime.com/901760/"> <img width="96" height="128" class="img_box" alt="西恩·潘/Sean Penn" src="http://img31.mtime.cn/ph/1760/901760/901760_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.1</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/901760/">西恩·潘</a></h3> <p> <a target="_blank" href="http://people.mtime.com/901760/">Sean Penn</a></p> <p class="mt15 c_666">男，生于1960年8月17日(美国加利福尼亚州)</p> <p class="c_666 mt6">1680人评分</p> </div> </div> </div> <div class="table"> <div class="t_r"> <div class="td"> <a title="凯文·科斯特纳/Kevin Costner" target="_blank" href="http://people.mtime.com/899480/"> <img width="96" height="128" class="img_box" alt="凯文·科斯特纳/Kevin Costner" src="http://img31.mtime.cn/ph/1480/899480/899480_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.1</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/899480/">凯文·科斯特纳</a></h3> <p> <a target="_blank" href="http://people.mtime.com/899480/">Kevin Costner</a></p> <p class="mt15 c_666">男，生于1955年1月18日(美国加州洛杉矶)</p> <p class="c_666 mt6">1669人评分</p> </div> </div> </div> </li> <li> <div class="table"> <div class="t_r"> <div class="td"> <a title="黑泽明/Akira Kurosawa" target="_blank" href="http://people.mtime.com/892857/"> <img width="96" height="128" class="img_box" alt="黑泽明/Akira Kurosawa" src="http://img31.mtime.cn/ph/857/892857/892857_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.3</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/892857/">黑泽明</a></h3> <p> <a target="_blank" href="http://people.mtime.com/892857/">Akira Kurosawa</a></p> <p class="mt15 c_666">男，生于1910年3月23日(日本东京)</p> <p class="c_666 mt6">1611人评分</p> </div> </div> </div> <div class="table"> <div class="t_r"> <div class="td"> <a title="蒂姆·罗宾斯/Tim Robbins" target="_blank" href="http://people.mtime.com/893026/"> <img width="96" height="128" class="img_box" alt="蒂姆·罗宾斯/Tim Robbins" src="http://img31.mtime.cn/ph/1026/893026/893026_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.3</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/893026/">蒂姆·罗宾斯</a></h3> <p> <a target="_blank" href="http://people.mtime.com/893026/">Tim Robbins</a></p> <p class="mt15 c_666">男，生于1958年10月16日(美国加州西柯汶纳)</p> <p class="c_666 mt6">1586人评分</p> </div> </div> </div> </li> <li> <div class="table"> <div class="t_r"> <div class="td"> <a title="岩井俊二/Shunji Iwai" target="_blank" href="http://people.mtime.com/892981/"> <img width="96" height="128" class="img_box" alt="岩井俊二/Shunji Iwai" src="http://img31.mtime.cn/ph/981/892981/892981_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.1</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/892981/">岩井俊二</a></h3> <p> <a target="_blank" href="http://people.mtime.com/892981/">Shunji Iwai</a></p> <p class="mt15 c_666">男，生于1963年1月24日(日本宫城县)</p> <p class="c_666 mt6">1555人评分</p> </div> </div> </div> <div class="table"> <div class="t_r"> <div class="td"> <a title="梅尔·吉布森/Mel Gibson" target="_blank" href="http://people.mtime.com/899901/"> <img width="96" height="128" class="img_box" alt="梅尔·吉布森/Mel Gibson" src="http://img31.mtime.cn/ph/1901/899901/899901_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.0</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/899901/">梅尔·吉布森</a></h3> <p> <a target="_blank" href="http://people.mtime.com/899901/">Mel Gibson</a></p> <p class="mt15 c_666">男，生于1956年1月3日(美国纽约)</p> <p class="c_666 mt6">1492人评分</p> </div> </div> </div> </li> <li> <div class="table"> <div class="t_r"> <div class="td"> <a title="梅拉尼·罗兰/Melanie Laurent" target="_blank" href="http://people.mtime.com/921874/"> <img width="96" height="128" class="img_box" alt="梅拉尼·罗兰/Melanie Laurent" src="http://img31.mtime.cn/ph/1874/921874/921874_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>8</span><span class=total2>.9</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/921874/">梅拉尼·罗兰</a></h3> <p> <a target="_blank" href="http://people.mtime.com/921874/">Melanie Laurent</a></p> <p class="mt15 c_666">女，生于1983年2月21日(法国巴黎)</p> <p class="c_666 mt6">1484人评分</p> </div> </div> </div> <div class="table"> <div class="t_r"> <div class="td"> <a title="北野武/Kitano Takeshi" target="_blank" href="http://people.mtime.com/892804/"> <img width="96" height="128" class="img_box" alt="北野武/Kitano Takeshi" src="http://img31.mtime.cn/ph/804/892804/892804_96X128.jpg"></a></div> <div class="td pl12 pr20"> <div class="clearfix"> <p class="point ml6"> <span class=total>9</span><span class=total2>.1</span> </p> </div> <h3 class="normal mt6"> <a target="_blank" href="http://people.mtime.com/892804/">北野武</a></h3> <p> <a target="_blank" href="http://people.mtime.com/892804/">Kitano Takeshi</a></p> <p class="mt15 c_666">男，生于1947年1月18日(日本东京)</p> <p class="c_666 mt6">1459人评分</p> </div> </div> </div> </li></ul>
"""

def get_info(rep_text, url='www.baidu.com'):
    resp_sel = HtmlResponse(url, body=rep_text.encode('utf-8'))
    sel_list = resp_sel.xpath('//ul[@class="ser_mlist2"]//li//div[@class="table"]')
    for sel in sel_list:
        doc = extract_one_person_info(sel)
        print(doc)


def extract_one_person_info(sel):
    name = ''.join(sel.xpath('.//div[@class="t_r"]/div[@class="td pl12 pr20"]/h3[@class="normal mt6"]/a/text()').extract())  # 中文名
    nameEn = ''.join(sel.xpath('.//div[@class="t_r"]/div[@class="td pl12 pr20"]/p/a/text()').extract())  # 英文名
    url = ''.join(sel.xpath('.//div[@class="t_r"]/div[@class="td pl12 pr20"]/h3[@class="normal mt6"]/a/@href').extract())  # 影人信息首页地址
    _id = ''.join(re.findall('\d+', url))  # id(str), 也许需要类型转换
    genre_birthdate_birthplace = ''.join(sel.xpath('.//div[@class="t_r"]/div[@class="td pl12 pr20"]/p[@class="mt15 c_666"]/text()').extract())  # 性别-出生地-出生地点
    rating_num = ''.join(sel.xpath('.//div[@class="t_r"]/div[@class="td pl12 pr20"]/p[@class="c_666 mt6"]/text()').extract())
    rating_num = ''.join(re.findall('\d+', rating_num))  # 评价数(str), 也许需要类型转换
    rating_score = ''.join(sel.xpath('.//div[@class="t_r"]/div[@class="td pl12 pr20"]/div[@class="clearfix"]/p[@class="point ml6"]//span//text()').extract())  # 评分(str),也许需要类型转换
    img = ''.join(sel.xpath('.//div[@class="t_r"]/div[@class="td"]/a/img[@class="img_box"]/@src').extract())  # 图片地址

    return {'name': name,
            'nameEn': nameEn,
            'url': url,
            '_id': _id,
            'id': _id,
            'genre_birthdate_birthplace': genre_birthdate_birthplace,
            'rating_num': rating_num,
            'rating_score': rating_score,
            'img': img
            }

##res = get_info(html)